function printForKitchen(kitchenType) {
    updateOrderTime();
    
    // Lọc danh sách món theo loại bếp
    let filteredDishes = [];
    if (kitchenType === 'pho') {
        filteredDishes = allDishes.filter(dish => dish.kitchenClass === 'pho-item');
    } else if (kitchenType === 'rice') {
        filteredDishes = allDishes.filter(dish => dish.kitchenClass === 'rice-item');
    }
    
    // Kiểm tra xem có món để in không
    if (filteredDishes.length === 0) {
        alert(`Không có món nào cho BẾP ${kitchenType === 'pho' ? 'PHỞ' : 'CƠM'}`);
        return;
    }
    
    // 1. Tạo nội dung HTML để in
    let printContent = `
        <html>
            <head>
                <meta charset="UTF-8">
                <style>
                    /* CSS tối ưu cho máy in nhiệt */
                    body { 
                        font-family: 'Arial', monospace; 
                        max-width: 80mm; 
                        margin: 0 auto; 
                        padding: 10px;
                        font-size: 14px;
                        line-height: 1.2;
                    }
                    .order-header { 
                        text-align: center; 
                        border-bottom: 1px dashed #000; 
                        padding-bottom: 8px; 
                        margin-bottom: 15px; 
                    }
                    .order-number { 
                        font-weight: bold; 
                        font-size: 16px; 
                        margin-bottom: 3px;
                    }
                    .table-info { 
                        font-weight: bold; 
                        font-size: 18px; 
                        margin: 5px 0; 
                    }
                    .service-name {
                        font-weight: bold;
                        margin-top: 5px;
                        font-size: 16px;
                    }
                    .dish-header, .dish-item { 
                        display: grid; 
                        grid-template-columns: 40px 1fr; 
                        margin-bottom: 5px;
                        align-items: start;
                    }
                    .dish-header { 
                        font-weight: bold; 
                        border-bottom: 1px solid #000; 
                        padding-bottom: 3px; 
                    }
                    .dish-quantity { 
                        text-align: center; 
                        font-weight: bold; 
                    }
                    .dish-name {
                        padding-left: 10px;
                        word-break: break-word;
                    }
                    .order-footer {
                        border-top: 1px dashed #000;
                        margin-top: 15px;
                        padding-top: 10px;
                        text-align: center;
                        font-size: 12px;
                    }
                </style>
            </head>
            <body>
                <div class="order-header">
                    <div class="order-number">${orderNumber}</div>
                    <div class="table-info">${tableInfo}</div>
                    <div class="service-name">ORDER BẾP ${kitchenType === 'pho' ? 'PHỞ' : 'CƠM'}</div>
                </div>
                
                <div class="dish-header">
                    <div>SL</div>
                    <div>TÊN MÓN</div>
                </div>
                
                <div class="dish-list">
    `;
    
    // 2. Thêm từng món ăn đã lọc vào nội dung HTML
    filteredDishes.forEach(dish => {
        printContent += `
            <div class="dish-item">
                <div class="dish-quantity">${dish.quantity}</div>
                <div class="dish-name">${dish.name}</div>
            </div>
        `;
    });
    
    // 3. Đóng thẻ HTML và thêm thông tin thời gian
    printContent += `
                </div>
                <div class="order-footer">
                    Order Time: ${getCurrentTime()}
                </div>
            </body>
        </html>
    `;
    
    // 4. Mã hóa nội dung HTML thành dạng URL an toàn
    const encodedHtml = encodeURIComponent(printContent);
    
    // 5. Tạo liên kết "print://" theo định dạng Looped Labs
    //    Thêm numCopies=1 để in 1 bản, có thể điều chỉnh số lượng
    const printUrl = `print://escpos.org/escpos/net/print?srcTp=uri&srcObj=html&numCopies=1&src=data:text/html,${encodedHtml}`;
    
    // 6. Thử mở liên kết để in
    try {
        window.location.href = printUrl;
        
        // Fallback: Nếu sau 1 giây mà không in được (ứng dụng chưa cài)
        setTimeout(function() {
            // Cung cấp tùy chọn in thông thường
            if (confirm('Ứng dụng in chưa được cài đặt. Bạn có muốn in bằng trình duyệt không?')) {
                const printWindow = window.open('', '_blank');
                printWindow.document.write(printContent);
                printWindow.document.close();
                printWindow.focus();
                printWindow.print();
                printWindow.close();
            }
        }, 1000);
        
    } catch (error) {
        console.error('Lỗi khi in:', error);
        alert('Có lỗi xảy ra khi in. Vui lòng kiểm tra ứng dụng in đã được cài đặt chưa.');
    }
}
